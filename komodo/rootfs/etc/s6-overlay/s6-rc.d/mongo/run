#!/usr/bin/with-contenv bashio
# shellcheck shell=bash
set -e

bashio::log.info "Starting MongoDB..."

# Ensure data directory exists
# Ensure data directory exists and has correct permissions
if [ ! -d /data/db ]; then
    mkdir -p /data/db
fi
# Only chown if needed to speed up startup on large datasets
if [ "$(stat -c %U /data/db 2>/dev/null)" != "mongodb" ]; then
    chown -R mongodb:mongodb /data/db
fi

exec sudo -u mongodb mongod --dbpath /data/db --bind_ip 127.0.0.1
