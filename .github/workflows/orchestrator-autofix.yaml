name: Orchestrator Auto-Fix

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - master

permissions:
  contents: write

jobs:
  auto-fix:
    name: ğŸ”§ Auto-Fix Everything
    runs-on: ubuntu-latest
    steps:
      - name: â¤µï¸ Check out code
        uses: actions/checkout@v6
        with:
          ref: ${{ github.head_ref }}

      # 1. Shell Scripts (Format)
      # 1. Shell Scripts (Format)
      - name: ğŸš Setup shfmt
        uses: mfinelli/setup-shfmt@v4
        with:
          shfmt-version: "3.7.0"

      - name: ğŸš Run shfmt
        run: shfmt -l -w .

      # 2. Python (Format & Sort Imports)
      # We format the internal scripts and any add-on python files
      - name: ğŸ Run Black (Formatter)
        uses: psf/black@stable
        with:
          options: "--verbose"
          src: "."

      - name: ğŸ Run Isort (Import Sorter)
        uses: isort/isort-action@master
        with:
          configuration: "--profile black"

      # 3. Prettier (JSON, YAML, MD)
      - name: ğŸ’… Run Prettier
        uses: creyD/prettier_action@v4.6
        with:
          prettier_options: --write "**/*.{json,js,md,yaml}"

      # 4. Standardize (READMEs, Beta Labels, Configs)
      - name: ğŸ“„ Standardize READMEs
        run: python3 .scripts/standardize_readmes.py

      # Commit back
      - name: ğŸ’¾ Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v7
        with:
          commit_message: "style: auto-fix (shfmt, black, isort, prettier)"
          branch: ${{ github.head_ref }}
